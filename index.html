<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>COâ‚‚å‰Šæ¸›ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆGoogleãƒãƒƒãƒ—ç‰ˆï¼‰å…¨ã¦AIè©¦ä½œå“</title>
   <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
  <div class="container">
   

    <h1>ğŸŒ COâ‚‚å‰Šæ¸›ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</h1>
    <p style="text-align:center;">Googleãƒãƒƒãƒ—ã§è·é›¢ã‚’è‡ªå‹•è¨ˆç®—ï¼</p>
    <p id="kome">â€»è»Šã®CO2æ’å‡ºé‡ã¨æ¯”è¼ƒã—ã¦ã©ã‚Œã ã‘å‰Šæ¸›ã—ãŸã‹</p>

    <form id="ecoForm">
      <label>å‡ºç™ºåœ°:</label>
      <input type="text" id="start" placeholder="ä¾‹ï¼šæ±äº¬é§…" required>

      <label>ç›®çš„åœ°:</label>
      <input type="text" id="end" placeholder="ä¾‹ï¼šæ¨ªæµœé§…" required>

      <label>äº¤é€šæ‰‹æ®µ:</label>
      <select id="transport" required>
        <option value="train">é›»è»Š</option>
        <option value="bus">ãƒã‚¹</option>
        <option value="bicycle">è‡ªè»¢è»Š</option>
        <option value="walk">å¾’æ­©</option>
      </select>

      <button type="submit">è·é›¢ã‚’è¨ˆç®—ã—ã¦COâ‚‚ã‚’ç®—å‡º</button>
    </form>

    <div id="result" class="result"></div>
    <div id="total" class="total"></div>
    <div id="define">â€»1æœ¬ã®æˆæœ¨ï¼ˆã‚¹ã‚®ãªã©ï¼‰ãŒå¹´é–“ã§ç´„14kgã®COâ‚‚ã‚’å¸å</div>

    <div id="map"></div>
    <canvas id="chart"></canvas>

 <h2 style="text-align:center;">ğŸŒ² å‰Šæ¸›ã—ãŸæœ¨ã‚’ä¸–ç•Œã«æ¤ãˆã‚ˆã†ï¼</h2>
    <div class="map-wrap" id="treeMapWrap">
      <img src="https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg"
           alt="ä¸–ç•Œåœ°å›³" class="map-img" id="treeMapImg" />
    </div>
    <p style="text-align:center;">ç´¯è¨ˆã§æ¤ãˆãŸæœ¨ã®æ•°ï¼š<strong id="treeCount">0</strong> æœ¬</p>
  </div>

  <script>
    // ğŸŒ³ æœ¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£
    const treeMapWrap = document.getElementById('treeMapWrap');
    const treeCountEl = document.getElementById('treeCount');
    let totalTrees = parseInt(localStorage.getItem("totalTrees") || "0");

    const treeSVG = `
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <g>
          <ellipse cx="32" cy="22" rx="18" ry="12" fill="#2e8b57"/>
          <ellipse cx="22" cy="26" rx="14" ry="10" fill="#228B22" opacity="0.95"/>
          <ellipse cx="42" cy="26" rx="14" ry="10" fill="#2E8B57" opacity="0.95"/>
          <rect x="28" y="28" width="8" height="18" rx="2" fill="#8b5a2b"/>
        </g>
      </svg>
    `;

    function updateTreeCount() {
      treeCountEl.textContent = totalTrees;
    }

    function addTreeAtRandom() {
      const el = document.createElement('div');
      el.className = 'tree';
      el.innerHTML = treeSVG;
      el.style.left = (Math.random() * 98 + 1) + '%';
      el.style.top = (Math.random() * 82 + 10) + '%';
      treeMapWrap.appendChild(el);
    }

    function plantTrees(n) {
      for (let i = 0; i < n; i++) {
        setTimeout(() => {
          addTreeAtRandom();
          totalTrees++;
          localStorage.setItem("totalTrees", totalTrees);
          updateTreeCount();
        }, i * 80);
      }
    }

    updateTreeCount();

    // ğŸŒ COâ‚‚è¨ˆç®—éƒ¨åˆ†
    const CO2_EMISSIONS = {
      car: 0.2,
      bus: 0.1,
      train: 0.05,
      bicycle: 0.0,
      walk: 0.0
    };
    const TREE_CO2 = 14;

    let map, directionsService, directionsRenderer;
    let ecoHistory = JSON.parse(localStorage.getItem("ecoHistory")) || [];

    const resultDiv = document.getElementById("result");
    const totalDiv = document.getElementById("total");
    const ctx = document.getElementById("chart").getContext("2d");

    // åˆè¨ˆè¡¨ç¤º
    function updateTotal() {
      const totalCO2 = ecoHistory.reduce((sum, item) => sum + item.savedCO2, 0);
      const trees = totalCO2 / TREE_CO2;
      totalDiv.textContent = `ğŸŒ³ ç´¯è¨ˆã§ ${totalCO2.toFixed(2)} kg ã®COâ‚‚ã‚’å‰Šæ¸›ï¼  
      æœ¨ã«ã™ã‚‹ã¨ç´„ ${trees.toFixed(1)} æœ¬åˆ†ã®å¸åé‡ã§ã™ã€‚`;
    }

    // ãƒãƒ£ãƒ¼ãƒˆåˆæœŸåŒ–
    let chart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: ecoHistory.map(item => item.date),
        datasets: [{
          label: "å‰Šæ¸›COâ‚‚é‡ (kg)",
          data: ecoHistory.map(item => item.savedCO2),
          borderWidth: 1,
          backgroundColor: "#81c784"
        }]
      },
      options: { scales: { y: { beginAtZero: true } } }
    });

    updateTotal();

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 35.6812, lng: 139.7671 },
        zoom: 10
      });
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer();
      directionsRenderer.setMap(map);
    }

    document.getElementById("ecoForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const start = document.getElementById("start").value;
      const end = document.getElementById("end").value;
      const transport = document.getElementById("transport").value;

      const request = {
        origin: start,
        destination: end,
        travelMode: "DRIVING"
      };

      directionsService.route(request, (result, status) => {
        if (status === "OK") {
          directionsRenderer.setDirections(result);
          const distance = result.routes[0].legs[0].distance.value / 1000;

          const carCO2 = distance * CO2_EMISSIONS.car;
          const selectedCO2 = distance * CO2_EMISSIONS[transport];
          const savedCO2 = carCO2 - selectedCO2;
          const treeEq = savedCO2 / TREE_CO2;
          const date = new Date().toLocaleDateString("ja-JP");

          resultDiv.textContent = `ğŸ“ è·é›¢: ${distance.toFixed(2)} km  
          ğŸš´â€â™‚ï¸ å‰Šæ¸›ã—ãŸCOâ‚‚: ${savedCO2.toFixed(2)} kg  
          ğŸŒ² æœ¨ã«æ›ç®—ã™ã‚‹ã¨ç´„ ${treeEq.toFixed(2)} æœ¬åˆ†ï¼`;

          ecoHistory.push({ date, savedCO2 });
          localStorage.setItem("ecoHistory", JSON.stringify(ecoHistory));

          chart.data.labels = ecoHistory.map(i => i.date);
          chart.data.datasets[0].data = ecoHistory.map(i => i.savedCO2);
          chart.update();

          updateTotal();

          // æœ¨ã‚’å‰Šæ¸›é‡ã«å¿œã˜ã¦æ¤ãˆã‚‹ğŸŒ³
          // æœ¨ã‚’å‰Šæ¸›é‡ã«å¿œã˜ã¦æ¤ãˆã‚‹ğŸŒ³
if (treeEq > 0) {
  plantTrees(Math.round(treeEq));
}



        } else {
          alert("çµŒè·¯ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚åœ°åã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        }
      });
    });
  </script>

  <!-- Google Maps API -->
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0Ueo952rowNyIi4OZtPbjKhfGx6NUlOw&callback=initMap">
    
  </script>
</body>
</html>
